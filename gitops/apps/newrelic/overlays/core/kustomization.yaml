apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- externalsecret.yaml

helmCharts:
- name: nri-bundle
  repo: https://helm-charts.newrelic.com
  version: 5.0.15
  releaseName: newrelic-bundle
  namespace: newrelic
  includeCRDs: true
  valuesInline:
    global:
      cluster: core
      lowDataMode: true
      customSecretName: newrelic
      customSecretKey: licenseKey
    newrelic-infrastructure:
      privileged: true
    kube-state-metrics:
      enabled: true
      image:
        tag: v2.7.0
    kubeEvents:
      enabled: true
    newrelic-prometheus-agent:
      enabled: true
      lowDataMode: true
      config:
        kubernetes:
          integrations_filter:
            enabled: false
    # logging:
    #   enabled: true
    # newrelic-logging:
    #   lowDataMode: true
    newrelic-pixie:
      enabled: true
      # apiKey: ""
      customSecretApiKeyName: newrelic
      customSecretApiKeyKey: pixie_apiKey
    pixie-chart:
      enabled: false
      customDeployKeySecret: newrelic # requires key to be 'deploy-key' in the secret
      clusterName: core
# - name: pixie-operator-chart
#   repo: https://pixie-operator-charts.storage.googleapis.com
#   releaseName: pixie
#   namespace: newrelic
#   includeCRDs: true
#   valuesInline:
#     customDeployKeySecret: newrelic
#     clusterName: core
#     pemMemoryLimit: 1Gi

patches:
- target:
    group: px.dev
    version: v1alpha1
    kind: Vizier
    name: pixie
    namespace: newrelic
  patch: |
    - op: remove
      path: /spec/deployKey