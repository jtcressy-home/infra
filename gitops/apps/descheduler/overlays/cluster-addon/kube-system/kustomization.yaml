apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../../../base

patches:
- target:
    kind: ConfigMap
    namespace: kube-system
    name: descheduler-policy-configmap
  patch: |
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: descheduler-policy-configmap
      namespace: kube-system
    data:
      policy.yaml: |
        apiVersion: descheduler/v1alpha1
        kind: DeschedulerPolicy
        strategies:
          RemoveDuplicates:
            enabled: true
          RemovePodsViolatingInterPodAntiAffinity:
            enabled: true
          RemovePodsViolatingNodeAffinity:
            enabled: true
          RemovePodsViolatingNodeTaints:
            enabled: true
          RemovePodsViolatingTopologySpreadConstraints:
            enabled: true
          LowNodeUtilization:
            enabled: true
            params:
              nodeResourceUtilizationThresholds:
                thresholds:
                  "cpu" : 20
                  "memory": 20
                  "pods": 20
                targetThresholds:
                  "cpu" : 50
                  "memory": 50
                  "pods": 50