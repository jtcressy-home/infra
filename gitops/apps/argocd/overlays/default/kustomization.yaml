namespace: argocd

resources:
- github.com/argoproj/argo-cd//manifests/ha/cluster-install?ref=v2.6.7
- infra-repo.yaml
- root-application.yaml

components:
- ../../components/namespace
# - ../../components/github-app-repo-creds
- ../../components/default-project-lockdown

patchesStrategicMerge:
- argocd-cm.yaml
- argocd-rbac-cm.yaml
# - patch-resources.yaml


patches:
- target:
    kind: "Service"
    name: "argocd-server"
  patch: |
    apiVersion: v1
    kind: Service
    metadata:
      name: argocd-server
      annotations:
        tailscale.com/expose: "true"
        tailscale.com/hostname: "argocd"