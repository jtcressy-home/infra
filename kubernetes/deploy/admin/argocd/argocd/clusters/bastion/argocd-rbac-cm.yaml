apiVersion: v1
data:
  policy.csv: |
    # User and team mappings
    g, argocd-admin, role:admin
    g, jtcressy-home:infra-admins, role:admin
    g, argocd-ro, role:readonly
    g, jtcressy@github, role:admin
    g, joel@jtcressy.net, role:admin

    # Branch-based GitHub Actions groups
    g, refs/heads/main, role:gh_actions_main
    g, refs/pull/*, role:gh_actions_pr

    # gh_actions_main role (admin access for main branch)
    p, role:gh_actions_main, applications, *, */*, allow
    p, role:gh_actions_main, repositories, *, *, allow
    p, role:gh_actions_main, clusters, *, *, allow
    p, role:gh_actions_main, projects, *, *, allow
    p, role:gh_actions_main, accounts, *, *, allow
    p, role:gh_actions_main, certificates, *, *, allow
    p, role:gh_actions_main, gpgkeys, *, *, allow

    # gh_actions_pr role (read-only for PRs)
    p, role:gh_actions_pr, applications, get, */*, allow
    p, role:gh_actions_pr, applications, list, */*, allow
    p, role:gh_actions_pr, repositories, get, *, allow
    p, role:gh_actions_pr, repositories, list, *, allow
    p, role:gh_actions_pr, clusters, get, *, allow
    p, role:gh_actions_pr, clusters, list, *, allow
    p, role:gh_actions_pr, projects, get, *, allow
  scopes: "[email, groups]"
kind: ConfigMap
metadata:
  name: argocd-rbac-cm