# kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1

resources:
- ../../../../base

patches:
- target:
    group: upgrade.cattle.io
    version: v1
    kind: Plan
    name: talos
  patch: |-
    - op: replace
      path: /metadata/name
      value: talos-vm-nvidia
    - op: add
      path: /spec/upgrade/envs/-
      value:
        name: SCHEMATIC_ID
        value: 9b47751f999bba95b35e9dfa5c9e8f1ea09c0d67cae30f49ae8a3ba8fbb059ef
    - op: add
      path: /spec/nodeSelector/matchExpressions/-
      value:
        key: factory.talos.dev/schematic-id.part-0
        operator: In
        values:
          - 9b47751f999bba95b35e9dfa5c9e8f1e
    - op: add
      path: /spec/nodeSelector/matchExpressions/-
      value:
        key: factory.talos.dev/schematic-id.part-1
        operator: In
        values:
          - a09c0d67cae30f49ae8a3ba8fbb059ef