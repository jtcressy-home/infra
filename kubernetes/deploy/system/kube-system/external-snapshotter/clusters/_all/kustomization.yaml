apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- github.com/kubernetes-csi/external-snapshotter//client/config/crd?ref=v8.1.0 # should match appVersion of snapshot-controller helm chart
helmCharts:
  - name: snapshot-controller
    repo: https://piraeus.io/helm-charts/
    version: 3.0.6
    releaseName: snapshot-controller
    namespace: kube-system
    includeCRDs: true
    valuesInline:
      controller:
        serviceMonitor:
          create: true

patches:
- target:
    group: apiextensions.k8s.io
    version: v1
    kind: CustomResourceDefinition
    name: '*'
  patch: |-
    - op: add
      path: /metadata/annotations
      value:
        argocd.argoproj.io/sync-options: "Replace=true"